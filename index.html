<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¯Ø®Ø§Ù† Ø§Ù„Ø¹Ø±Ø¨ÙŠ</title>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background-color: #f9f9f9;
      margin: 0;
      padding: 0;
      color: #333;
    }
    header {
      background-color: #2c7be5;
      color: white;
      text-align: center;
      padding: 15px;
      font-size: 1.3em;
      font-weight: bold;
    }
    main {
      padding: 15px;
    }
    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      padding: 15px;
    }
    h2 {
      font-size: 1.1em;
      margin-bottom: 10px;
      color: #2c7be5;
    }
    label {
      display: block;
      margin: 8px 0 3px;
      font-size: 0.9em;
    }
    input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    button {
      width: 100%;
      padding: 10px;
      background: #2c7be5;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1em;
      cursor: pointer;
    }
    button:hover {
      background: #1a5dcc;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border-bottom: 1px solid #eee;
      padding: 8px;
      text-align: center;
      font-size: 0.9em;
    }
    .actions button {
      width: auto;
      padding: 4px 8px;
      margin: 0 2px;
      border-radius: 5px;
      font-size: 0.8em;
    }
    .edit-btn { background: #ffc107; color: #000; }
    .delete-btn { background: #dc3545; }
    .stats {
      display: flex;
      justify-content: space-around;
      text-align: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    .stat-box {
      background: #e9f2ff;
      border-radius: 8px;
      padding: 10px;
      flex: 1;
      min-width: 100px;
    }
    .stat-box h3 {
      margin: 0;
      font-size: 1em;
      color: #2c7be5;
    }
    .stat-box p {
      font-size: 1em;
      font-weight: bold;
      margin: 5px 0 0;
    }
  </style>
</head>
<body>
  <header>ğŸ’¨ ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¯Ø®Ø§Ù† Ø§Ù„Ø¹Ø±Ø¨ÙŠ</header>
  <main>
    <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
    <div class="card">
      <h2>ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h2>
      <div class="stats">
        <div class="stat-box">
          <h3>Ø±Ø¨Ø­ Ø§Ù„ÙŠÙˆÙ…</h3>
          <p id="dailyProfit">0 â‚ª</p>
        </div>
        <div class="stat-box">
          <h3>Ø±Ø¨Ø­ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</h3>
          <p id="weeklyProfit">0 â‚ª</p>
        </div>
        <div class="stat-box">
          <h3>Ø±Ø¨Ø­ Ø§Ù„Ø´Ù‡Ø±</h3>
          <p id="monthlyProfit">0 â‚ª</p>
        </div>
      </div>
    </div>

    <!-- Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª -->
    <div class="card">
      <h2>ğŸ“¦ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h2>
      <input type="hidden" id="buyEditIndex">
      <label>Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
      <input type="date" id="buyDate">
      <label>Ø§Ù„ÙƒÙ…ÙŠØ© (ÙƒØº):</label>
      <input type="number" id="buyQty">
      <label>Ø³Ø¹Ø± Ø§Ù„ÙƒÙŠÙ„Ùˆ (â‚ª):</label>
      <input type="number" id="buyPrice">
      <button onclick="addPurchase()">ğŸ’° Ø­ÙØ¸ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</button>
    </div>

    <!-- Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª -->
    <div class="card">
      <h2>ğŸ’¸ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h2>
      <input type="hidden" id="sellEditIndex">
      <label>Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
      <input type="date" id="sellDate">
      <label>Ø§Ù„ÙƒÙ…ÙŠØ© (ÙƒØº):</label>
      <input type="number" id="sellQty">
      <label>Ø³Ø¹Ø± Ø§Ù„ÙƒÙŠÙ„Ùˆ (â‚ª):</label>
      <input type="number" id="sellPrice">
      <button onclick="addSale()">ğŸ“ˆ Ø­ÙØ¸ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</button>
    </div>

    <!-- Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ -->
    <div class="card">
      <h2>ğŸ“‹ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h2>
      <table id="purchasesTable">
        <tr><th>ØªØ§Ø±ÙŠØ®</th><th>ÙƒÙ…ÙŠØ©</th><th>Ø³Ø¹Ø± Ø§Ù„ÙƒÙŠÙ„Ùˆ</th><th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr>
      </table>
    </div>

    <div class="card">
      <h2>ğŸ§¾ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h2>
      <table id="salesTable">
        <tr><th>ØªØ§Ø±ÙŠØ®</th><th>ÙƒÙ…ÙŠØ©</th><th>Ø³Ø¹Ø± Ø§Ù„ÙƒÙŠÙ„Ùˆ</th><th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr>
      </table>
    </div>

    <!-- ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® -->
    <div class="card">
      <h2>ğŸ“… ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®</h2>
      <table id="profitTable">
        <tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ (â‚ª)</th></tr>
      </table>
    </div>
  </main>

  <script>
    let purchases = JSON.parse(localStorage.getItem('purchases') || '[]');
    let sales = JSON.parse(localStorage.getItem('sales') || '[]');

    function addPurchase() {
      const date = document.getElementById('buyDate').value;
      const qty = parseFloat(document.getElementById('buyQty').value);
      const price = parseFloat(document.getElementById('buyPrice').value);
      const editIndex = document.getElementById('buyEditIndex').value;

      if (!date || !qty || !price) return alert('Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');

      if (editIndex) {
        purchases[editIndex] = { date, qty, price };
        document.getElementById('buyEditIndex').value = '';
      } else {
        purchases.push({ date, qty, price });
      }

      localStorage.setItem('purchases', JSON.stringify(purchases));
      renderTables();
      updateStats();
      clearInputs('buy');
    }

    function addSale() {
      const date = document.getElementById('sellDate').value;
      const qty = parseFloat(document.getElementById('sellQty').value);
      const price = parseFloat(document.getElementById('sellPrice').value);
      const editIndex = document.getElementById('sellEditIndex').value;

      if (!date || !qty || !price) return alert('Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');

      if (editIndex) {
        sales[editIndex] = { date, qty, price };
        document.getElementById('sellEditIndex').value = '';
      } else {
        sales.push({ date, qty, price });
      }

      localStorage.setItem('sales', JSON.stringify(sales));
      renderTables();
      updateStats();
      clearInputs('sell');
    }

    function clearInputs(type) {
      document.getElementById(type + 'Date').value = '';
      document.getElementById(type + 'Qty').value = '';
      document.getElementById(type + 'Price').value = '';
    }

    function editPurchase(index) {
      const p = purchases[index];
      document.getElementById('buyDate').value = p.date;
      document.getElementById('buyQty').value = p.qty;
      document.getElementById('buyPrice').value = p.price;
      document.getElementById('buyEditIndex').value = index;
    }

    function deletePurchase(index) {
      if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ')) {
        purchases.splice(index, 1);
        localStorage.setItem('purchases', JSON.stringify(purchases));
        renderTables();
        updateStats();
      }
    }

    function editSale(index) {
      const s = sales[index];
      document.getElementById('sellDate').value = s.date;
      document.getElementById('sellQty').value = s.qty;
      document.getElementById('sellPrice').value = s.price;
      document.getElementById('sellEditIndex').value = index;
    }

    function deleteSale(index) {
      if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ')) {
        sales.splice(index, 1);
        localStorage.setItem('sales', JSON.stringify(sales));
        renderTables();
        updateStats();
      }
    }

    function renderTables() {
      const pTable = document.getElementById('purchasesTable');
      const sTable = document.getElementById('salesTable');
      const profitTable = document.getElementById('profitTable');

      pTable.innerHTML = `<tr><th>ØªØ§Ø±ÙŠØ®</th><th>ÙƒÙ…ÙŠØ©</th><th>Ø³Ø¹Ø± Ø§Ù„ÙƒÙŠÙ„Ùˆ</th><th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr>`;
      sTable.innerHTML = `<tr><th>ØªØ§Ø±ÙŠØ®</th><th>ÙƒÙ…ÙŠØ©</th><th>Ø³Ø¹Ø± Ø§Ù„ÙƒÙŠÙ„Ùˆ</th><th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr>`;
      profitTable.innerHTML = `<tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ (â‚ª)</th></tr>`;

      purchases.forEach((p, i) => {
        const total = p.qty * p.price;
        pTable.innerHTML += `<tr>
          <td>${p.date}</td>
          <td>${p.qty}</td>
          <td>${p.price}</td>
          <td>${total}</td>
          <td class="actions">
            <button class="edit-btn" onclick="editPurchase(${i})">ØªØ¹Ø¯ÙŠÙ„</button>
            <button class="delete-btn" onclick="deletePurchase(${i})">Ø­Ø°Ù</button>
          </td>
        </tr>`;
      });
      sales.forEach((s, i) => {
        const total = s.qty * s.price;
        sTable.innerHTML += `<tr>
          <td>${s.date}</td>
          <td>${s.qty}</td>
          <td>${s.price}</td>
          <td>${total}</td>
          <td class="actions">
            <button class="edit-btn" onclick="editSale(${i})">ØªØ¹Ø¯ÙŠÙ„</button>
            <button class="delete-btn" onclick="deleteSale(${i})">Ø­Ø°Ù</button>
          </td>
        </tr>`;
      });

      // Ø­Ø³Ø§Ø¨ ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ Ù„ÙƒÙ„ ÙŠÙˆÙ…
      const allDates = [...new Set([...purchases.map(p => p.date), ...sales.map(s => s.date)])];
      allDates.sort((a, b) => new Date(a) - new Date(b));

      allDates.forEach(date => {
        const dayPurchases = purchases.filter(p => p.date === date)
          .reduce((sum, p) => sum + p.qty * p.price, 0);
        const daySales = sales.filter(s => s.date === date)
          .reduce((sum, s) => sum + s.qty * s.price, 0);
        const profit = daySales - dayPurchases;
        profitTable.innerHTML += `<tr><td>${date}</td><td>${profit}</td></tr>`;
      });
    }

    function updateStats() {
      const today = new Date();
      const getSum = (arr, start, end) => arr
        .filter(a => {
          const d = new Date(a.date);
          return d >= start && d <= end;
        })
        .reduce((sum, a) => sum + a.qty * a.price, 0);

      const sumPurchases = (start, end) => getSum(purchases, start, end);
      const sumSales = (start, end) => getSum(sales, start, end);

      const getRange = days => {
        const end = new Date();
        const start = new Date();
        start.setDate(end.getDate() - days);
        return [start, end];
      };

      const [d1, d2] = getRange(0);
      const [w1, w2] = getRange(7);
      const [m1, m2] = getRange(30);

      document.getElementById('dailyProfit').textContent = (sumSales(d1, d2) - sumPurchases(d1, d2)) + ' â‚ª';
      document.getElementById('weeklyProfit').textContent = (sumSales(w1, w2) - sumPurchases(w1, w2)) + ' â‚ª';
      document.getElementById('monthlyProfit').textContent = (sumSales(m1, m2) - sumPurchases(m1, m2)) + ' â‚ª';
    }

    renderTables();
    updateStats();
  </script>
</body>
</html>
